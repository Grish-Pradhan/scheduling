<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <title>CPU Scheduler</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 30px 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .container { 
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 1200px;
        }
        
        h2 { 
            color: #333;
            margin-bottom: 30px;
            font-weight: 600;
            text-align: center;
        }
        
        .section-header {
            color: #667eea;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            display: block;
        }
        
        .control-group {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .control-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .form-control {
            border-radius: 6px;
            border: 2px solid #e0e0e0;
            padding: 10px 12px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            border-radius: 6px;
            padding: 10px 16px;
            font-weight: 600;
            border: none;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-warning:hover {
            background: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3);
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-info {
            background: #3b82f6;
            color: white;
        }
        
        .btn-info:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
            font-size: 10px;
            padding: 6px 10px;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .table-container {
            max-height: 450px;
            overflow-y: auto;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            margin: 20px 0;
        }
        
        .table {
            margin: 0;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .table thead th {
            border: none;
            padding: 15px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
        }
        
        .table tbody tr {
            border-bottom: 1px solid #e0e0e0;
            transition: background 0.2s ease;
        }
        
        .table tbody tr:hover {
            background: #f0f4ff;
        }
        
        .table tbody td, .table tbody th {
            padding: 12px 15px;
            vertical-align: middle;
        }
        
        .chart-section {
            margin: 40px 0;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 25px;
            border-left: 4px solid #667eea;
        }
        
        .chart-section h4 {
            color: #333;
            font-weight: 600;
            margin-bottom: 20px;
            text-transform: uppercase;
            font-size: 14px;
            letter-spacing: 0.5px;
        }
        
        #ganttChart {
            display: flex;
            align-items: flex-start;
            gap: 0;
            min-width: 100%;
            position: relative;
            background: white;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            min-height: 80px;
        }
        
        #ganttTimeline {
            display: flex;
            align-items: flex-end;
            margin-top: 10px;
            font-size: 11px;
            font-weight: bold;
            color: #667eea;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .metric-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .metric-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .metric-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 28px;
            font-weight: 700;
        }
        
        .row {
            margin-bottom: 20px;
        }
        
        .col-md-6 {
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .button-group button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h2>‚öôÔ∏è CPU Scheduler Simulator</h2>
    
    <div class="row">
        <div class="col-md-6">
            <div class="control-group">
                <span class="section-header">Scheduling Algorithm</span>
                <select id="algorithm" class="form-control">
                    <option value="FCFS">First Come First Served (FCFS)</option>
                    <option value="SJF">Shortest Job First (SJF)</option>
                    <option value="SRJF">Shortest Remaining Job First (SRJF)</option>
                    <option value="RR">Round Robin</option>
                    <option value="Priority">Priority Scheduling</option>
                </select>
            </div>
        </div>
        <div class="col-md-6">
            <div class="control-group">
                <span class="section-header">Context Switch Time</span>
                <input id="contextSwitch" type="number" class="form-control" value="0" min="0" step="0.5">
                
                <div id="quantumDiv" style="margin-top: 15px; display: none;">
                    <span class="section-header">Time Quantum (Round Robin)</span>
                    <input id="timeQuantum" type="number" class="form-control" value="2" min="1" step="1">
                </div>
            </div>
        </div>
    </div>

    <div class="control-group">
        <span class="section-header">Processes</span>
        <div class="button-group">
            <button class="btn btn-success" onclick="addProcess()">‚úö Add Process</button>
            <button class="btn btn-warning" onclick="removeProcess()">‚úï Remove Process</button>
            <button class="btn btn-primary" onclick="calculateSchedule()">‚ñ∂ Calculate Schedule</button>
            <button class="btn btn-info" onclick="resetTable()">‚Ü∫ Reset to Default</button>
        </div>
    </div>

    <div class="table-container">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th style="width: 10%;">Process</th>
                    <th style="width: 20%;">Arrival Time</th>
                    <th style="width: 20%;">Burst Time</th>
                    <th style="width: 20%;">Priority</th>
                    <th style="width: 15%;">Action</th>
                </tr>
            </thead>
            <tbody id="processTable">
            </tbody>
        </table>
    </div>

    <div class="chart-section">
        <h4>üìä Gantt Chart (A4 Size)</h4>
        <div style="margin-top: 20px; background: white; padding: 20px; border-radius: 6px; border: 1px solid #ddd;">
            <div style="width: 21cm; height: 29.7cm; max-width: 100%; margin: 0 auto; position: relative; background: white; border: 1px solid #ccc;">
                <svg id="ganttSVG" style="width: 100%; height: 100%; background: white; display: block;"></svg>
            </div>
        </div>
    </div>

    <div class="metrics" id="metrics" style="display: none;">
        <div class="metric-box">
            <div class="metric-label">Avg Waiting Time</div>
            <div class="metric-value" id="avgWait">-</div>
        </div>
        <div class="metric-box">
            <div class="metric-label">Avg Turnaround Time</div>
            <div class="metric-value" id="avgTurnaround">-</div>
        </div>
        <div class="metric-box">
            <div class="metric-label">Total Execution Time</div>
            <div class="metric-value" id="totalTime">-</div>
        </div>
    </div>
</div>

<script>
const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2', '#F8B88B', '#52C4A1'];

function initTable(count = 3) {
    const table = document.getElementById('processTable');
    table.innerHTML = '';
    for (let i = 1; i <= count; i++) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <th>P${i}</th>
            <td><input type="number" class="arrival form-control" value="${(i-1) % 3}" min="0" step="1"></td>
            <td><input type="number" class="burst form-control" value="${3 + (i-1) % 4}" min="1" step="1"></td>
            <td><input type="number" class="priority form-control" value="${i}" min="1" step="1"></td>
            <td><button class="btn btn-danger" onclick="this.parentElement.parentElement.remove()">Delete</button></td>
        `;
        table.appendChild(row);
    }
}

function addProcess() {
    const count = document.getElementById('processTable').children.length + 1;
    const table = document.getElementById('processTable');
    const row = document.createElement('tr');
    row.innerHTML = `
        <th>P${count}</th>
        <td><input type="number" class="arrival form-control" value="0" min="0" step="1"></td>
        <td><input type="number" class="burst form-control" value="3" min="1" step="1"></td>
        <td><input type="number" class="priority form-control" value="${count}" min="1" step="1"></td>
        <td><button class="btn btn-danger" onclick="this.parentElement.parentElement.remove()">Delete</button></td>
    `;
    table.appendChild(row);
}

function removeProcess() {
    const rows = document.getElementById('processTable').children;
    if (rows.length > 1) {
        rows[rows.length - 1].remove();
    }
}

function resetTable() {
    initTable(3);
    calculateSchedule();
}

function getProcesses() {
    const rows = Array.from(document.getElementById('processTable').children);
    const processes = [];
    rows.forEach((row, idx) => {
        processes.push({
            id: idx + 1,
            arrival: parseInt(row.children[1].children[0].value) || 0,
            burst: parseInt(row.children[2].children[0].value) || 1,
            priority: parseInt(row.children[3].children[0].value) || idx + 1
        });
    });
    return processes;
}

function calculateSchedule() {
    const algo = document.getElementById('algorithm').value;
    const contextSwitch = parseFloat(document.getElementById('contextSwitch').value) || 0;
    const processes = getProcesses();

    let schedule;
    if (algo === 'FCFS') schedule = scheduleFCFS(processes, contextSwitch);
    else if (algo === 'SJF') schedule = scheduleSJF(processes, contextSwitch);
    else if (algo === 'SRJF') schedule = scheduleSRJF(processes, contextSwitch);
    else if (algo === 'RR') {
        const quantum = parseInt(document.getElementById('timeQuantum').value) || 2;
        schedule = scheduleRR(processes, quantum, contextSwitch);
    }
    else if (algo === 'Priority') schedule = schedulePriority(processes, contextSwitch);

    displayResults(schedule, processes);
}

function scheduleFCFS(processes, cs) {
    const sorted = [...processes].sort((a, b) => a.arrival - b.arrival);
    const schedule = [];
    let time = 0;
    
    sorted.forEach(p => {
        if (time < p.arrival) time = p.arrival;
        schedule.push({ id: p.id, start: time, end: time + p.burst });
        time += p.burst + cs;
    });
    return schedule;
}

function scheduleSJF(processes, cs) {
    const schedule = [];
    const remaining = [...processes];
    let time = 0;
    
    while (remaining.length > 0) {
        const available = remaining.filter(p => p.arrival <= time);
        if (available.length === 0) {
            time = remaining.reduce((min, p) => Math.min(min, p.arrival), Infinity);
            continue;
        }
        const p = available.reduce((min, cur) => cur.burst < min.burst ? cur : min);
        schedule.push({ id: p.id, start: time, end: time + p.burst });
        time += p.burst + cs;
        remaining.splice(remaining.indexOf(p), 1);
    }
    return schedule;
}

function scheduleRR(processes, quantum, cs) {
    const schedule = [];
    const remaining = processes.map(p => ({...p, remaining: p.burst}));
    const queue = [];
    let time = 0;
    let processed = 0;
    
    while (processed < processes.length) {
        // Add all processes that have arrived by current time
        remaining.forEach(p => {
            if (p.arrival <= time && !p.inQueue && p.remaining > 0) {
                queue.push(p);
                p.inQueue = true;
            }
        });
        
        // If queue is empty, jump to next arrival time
        if (queue.length === 0) {
            time = remaining.filter(p => p.remaining > 0).reduce((min, p) => Math.min(min, p.arrival), Infinity);
            continue;
        }
        
        const p = queue.shift();
        const exec = Math.min(quantum, p.remaining);
        schedule.push({ id: p.id, start: time, end: time + exec });
        
        p.remaining -= exec;
        time += exec;
        
        // After execution, check for newly arrived processes
        remaining.forEach(proc => {
            if (proc.arrival <= time && !proc.inQueue && proc.remaining > 0) {
                queue.push(proc);
                proc.inQueue = true;
            }
        });
        
        // If process not finished, add back to queue
        if (p.remaining > 0) {
            queue.push(p);
        } else {
            processed++;
        }
        
        // Add context switch time only if queue is not empty
        if (queue.length > 0) {
            time += cs;
        }
    }
    
    return schedule;
}

function schedulePriority(processes, cs) {
    const schedule = [];
    const remaining = [...processes];
    let time = 0;
    
    while (remaining.length > 0) {
        const available = remaining.filter(p => p.arrival <= time);
        if (available.length === 0) {
            time = remaining.reduce((min, p) => Math.min(min, p.arrival), Infinity);
            continue;
        }
        const p = available.reduce((min, cur) => cur.priority < min.priority ? cur : min);
        schedule.push({ id: p.id, start: time, end: time + p.burst });
        time += p.burst + cs;
        remaining.splice(remaining.indexOf(p), 1);
    }
    return schedule;
}

function displayResults(schedule, processes) {
    const svg = document.getElementById('ganttSVG');
    svg.innerHTML = '';
    
    if (schedule.length === 0) return;
    
    const maxTime = Math.max(...schedule.map(s => s.end));
    
    // A4 dimensions: 210mm x 297mm, convert to pixels (96 DPI)
    const a4Width = 1000; // pixels for A4 width
    const a4Height = 1415; // pixels for A4 height
    
    svg.setAttribute('viewBox', `0 0 ${a4Width} ${a4Height}`);
    svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
    
    const margin = 50;
    const blockHeight = 60;
    const blockY = 150;
    const timelineY = blockY + blockHeight + 30;
    const availableWidth = a4Width - 2 * margin;
    const pixelsPerUnit = availableWidth / (maxTime + 1);
    
    const processColorMap = {};
    processes.forEach((p, idx) => {
        processColorMap[p.id] = colors[idx % colors.length];
    });
    
    // Draw blocks
    schedule.forEach((s) => {
        const duration = s.end - s.start;
        const x = margin + s.start * pixelsPerUnit;
        const width = duration * pixelsPerUnit;
        
        // Block rectangle
        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        rect.setAttribute('x', x);
        rect.setAttribute('y', blockY);
        rect.setAttribute('width', width);
        rect.setAttribute('height', blockHeight);
        rect.setAttribute('fill', processColorMap[s.id]);
        rect.setAttribute('stroke', '#000');
        rect.setAttribute('stroke-width', '1.5');
        rect.style.cursor = 'pointer';
        
        // Block label
        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('x', x + width / 2);
        text.setAttribute('y', blockY + blockHeight / 2 + 8);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('font-size', '18');
        text.setAttribute('font-weight', 'bold');
        text.setAttribute('fill', 'white');
        text.textContent = `P${s.id}`;
        
        // Tooltip group
        const tooltip = document.createElementNS('http://www.w3.org/2000/svg', 'g');
        tooltip.setAttribute('opacity', '0');
        tooltip.style.transition = 'opacity 0.3s ease';
        
        const tooltipRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        tooltipRect.setAttribute('x', Math.max(margin, x + width / 2 - 60));
        tooltipRect.setAttribute('y', blockY - 60);
        tooltipRect.setAttribute('width', '120');
        tooltipRect.setAttribute('height', '50');
        tooltipRect.setAttribute('fill', '#000');
        tooltipRect.setAttribute('rx', '4');
        
        const tooltipText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        tooltipText.setAttribute('x', x + width / 2);
        tooltipText.setAttribute('y', blockY - 35);
        tooltipText.setAttribute('text-anchor', 'middle');
        tooltipText.setAttribute('font-size', '14');
        tooltipText.setAttribute('fill', 'white');
        tooltipText.textContent = `P${s.id}`;
        
        const tooltipText2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        tooltipText2.setAttribute('x', x + width / 2);
        tooltipText2.setAttribute('y', blockY - 18);
        tooltipText2.setAttribute('text-anchor', 'middle');
        tooltipText2.setAttribute('font-size', '12');
        tooltipText2.setAttribute('fill', 'white');
        tooltipText2.textContent = `Start: ${s.start}`;
        
        const tooltipText3 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        tooltipText3.setAttribute('x', x + width / 2);
        tooltipText3.setAttribute('y', blockY);
        tooltipText3.setAttribute('text-anchor', 'middle');
        tooltipText3.setAttribute('font-size', '12');
        tooltipText3.setAttribute('fill', 'white');
        tooltipText3.textContent = `Duration: ${s.end - s.start}`;
        
        tooltip.appendChild(tooltipRect);
        tooltip.appendChild(tooltipText);
        tooltip.appendChild(tooltipText2);
        tooltip.appendChild(tooltipText3);
        
        const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
        group.addEventListener('mouseover', () => {
            tooltip.setAttribute('opacity', '1');
        });
        group.addEventListener('mouseout', () => {
            tooltip.setAttribute('opacity', '0');
        });
        
        group.appendChild(rect);
        group.appendChild(text);
        group.appendChild(tooltip);
        
        svg.appendChild(group);
    });
    
    // Draw timeline (horizontal line)
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', margin);
    line.setAttribute('y1', timelineY);
    line.setAttribute('x2', margin + availableWidth);
    line.setAttribute('y2', timelineY);
    line.setAttribute('stroke', '#000');
    line.setAttribute('stroke-width', '2');
    svg.appendChild(line);
    
    // Draw time ticks and labels
    for (let i = 0; i <= maxTime; i++) {
        const x = margin + i * pixelsPerUnit;
        
        // Tick
        const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        tick.setAttribute('x1', x);
        tick.setAttribute('y1', timelineY);
        tick.setAttribute('x2', x);
        tick.setAttribute('y2', timelineY + 10);
        tick.setAttribute('stroke', '#000');
        tick.setAttribute('stroke-width', '1.5');
        svg.appendChild(tick);
        
        // Label
        const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        label.setAttribute('x', x);
        label.setAttribute('y', timelineY + 30);
        label.setAttribute('text-anchor', 'middle');
        label.setAttribute('font-size', '14');
        label.setAttribute('font-weight', 'bold');
        label.textContent = i;
        svg.appendChild(label);
    }

    const waitingTimes = processes.map(p => {
        const first = schedule.find(s => s.id === p.id);
        return first ? first.start - p.arrival : 0;
    });
    const turnarounds = processes.map(p => {
        const last = schedule.filter(s => s.id === p.id).pop();
        return last ? last.end - p.arrival : 0;
    });

    document.getElementById('avgWait').textContent = (waitingTimes.reduce((a, b) => a + b, 0) / processes.length).toFixed(2);
    document.getElementById('avgTurnaround').textContent = (turnarounds.reduce((a, b) => a + b, 0) / processes.length).toFixed(2);
    document.getElementById('totalTime').textContent = Math.max(...schedule.map(s => s.end));
    document.getElementById('metrics').style.display = 'grid';
    
    console.log("Schedule:", schedule);
    console.log("Gantt rendered");
}

document.getElementById('algorithm').addEventListener('change', (e) => {
    document.getElementById('quantumDiv').style.display = e.target.value === 'RR' ? 'block' : 'none';
});

initTable(3);
</script>
</body>
</html>